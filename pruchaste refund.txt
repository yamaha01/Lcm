select distinct ejn.invoice_no as InvoiceNo, ejn.ins_dt as InvDate, ejn.airline_cd as AirCd, am.airline_nm as VendorName, nq.amount as InvoiceAmount, nq.total_amt as PrimeOwing, cbc.AP as BaseTaxOwing, ejn.ins_dt as DueDate, (nq.total_amt - cbc.AP)`SvcIncome` from (select ej.job_no, ej.invoice_no, ej.job_dt, ej.cust_cd, ag.airline_cd, ag.ins_dt, ej.pod_final, ej.remarks from clx_entry_job ej, clx_aga01 ag where ag.job_no = ej.job_no and ag.slip_type = 'I' and ag.ins_dt BETWEEN '2014/01/01' AND '2014/04/30') ejn left join (SELECT seq, cbp.job_no, freight_cd, cust_kind, bill_dt, curr_cd, tax_cd, amt_tax, qty, exchange_rate, SUM(`amt_bill`)`amount`, SUM(qty * amt_bill)`total_amt` FROM lcm.clx_bill_prepaid cbp group by job_no) nq on ejn.job_no = nq.job_no inner join clx_cust_mst cm on ejn.cust_cd = cm.cust_cd inner join (SELECT airmst.airline_cd, airline_nm FROM clx_air_mst airmst) am on am.airline_cd = ejn.airline_cd inner join (SELECT job_no, freight_cd, cust_kind, cust_cd, bill_dt, curr_cd, tax_cd, amt_tax, qty, exchange_rate, amt_bill, remark, invoice_no, ins_dt, ins_id, upd_dt, upd_id, del_id, del_dt, SUM(qty * amt_bill)`AP` FROM lcm.clx_bill_cost where freight_cd != 'ZF' group by job_no) cbc on ejn.job_no = cbc.job_no
